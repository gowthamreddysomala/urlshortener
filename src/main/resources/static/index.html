<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>URL Shortener by Gowtham Reddy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
          /* Light theme defaults */
          --bg: #f7f8fc;
          --bg-2: rgba(0,0,0,0.06);
          --card: rgba(255,255,255,0.9);
          --text: #111827;
          --muted: #6b7280;
          --brand: #7c3aed;
          --brand-2: #22d3ee;
          --accent: #22c55e;
          --danger: #ef4444;
          --ring: rgba(124,58,237,0.25);
          --radius: 14px;
          --shadow: 0 10px 30px rgba(0,0,0,0.10);
        }

        /* Dark theme overrides */
        .dark {
          --bg: #0b1020;
          --bg-2: rgba(255,255,255,0.06);
          --card: rgba(13,17,23,0.6);
          --text: #e5e7eb;
          --muted: #9aa3b2;
          --ring: rgba(124,58,237,0.45);
          --shadow: 0 10px 30px rgba(0,0,0,0.35);
        }

        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
          margin: 0;
          font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
          color: var(--text);
          /* Light background */
          background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent 60%),
                      radial-gradient(1000px 500px at 90% 20%, rgba(34,211,238,0.10), transparent 60%),
                      linear-gradient(180deg, #ffffff 0%, #eef2ff 100%);
          display: grid;
          grid-template-rows: auto 1fr auto;
          min-height: 100vh;
        }

        /* Dark background */
        .dark body {
          background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.25), transparent 60%),
                      radial-gradient(1000px 500px at 90% 20%, rgba(34,211,238,0.2), transparent 60%),
                      linear-gradient(180deg, #0b1020 0%, #0a0f1e 100%);
        }

        header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 20px 28px;
        }

        .brand {
          display: inline-flex;
          align-items: center;
          gap: 10px;
          font-weight: 800;
          letter-spacing: 0.2px;
          user-select: none;
        }

        .logo {
          width: 36px; height: 36px;
          display: grid; place-items: center;
          border-radius: 10px;
          background: linear-gradient(135deg, var(--brand), var(--brand-2));
          box-shadow: inset 0 -6px 14px rgba(255,255,255,0.06), inset 0 6px 20px rgba(0,0,0,0.25);
        }
        .logo svg { filter: drop-shadow(0 4px 10px rgba(34,211,238,0.35)); }

        .theme-toggle {
          position: relative;
          display: inline-flex; align-items: center; justify-content: center;
          width: 52px; height: 32px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.08);
          background: var(--bg-2);
          color: var(--text);
          cursor: pointer;
          box-shadow: var(--shadow);
        }

        main { display: grid; place-items: center; padding: 20px; }

        .card {
          width: 100%; max-width: 980px;
          background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.72));
          backdrop-filter: blur(10px);
          border: 1px solid rgba(0,0,0,0.06);
          border-radius: var(--radius);
          box-shadow: var(--shadow);
          overflow: hidden;
        }

        /* Dark card surface */
        .dark .card {
          background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
          border: 1px solid rgba(255,255,255,0.08);
        }

        .card-inner { display: grid; grid-template-columns: 1.2fr 1fr; }
        @media (max-width: 900px) { .card-inner { grid-template-columns: 1fr; } }

        .hero {
          padding: 36px 36px 16px 36px;
          border-right: 1px solid rgba(255,255,255,0.06);
        }
        @media (max-width: 900px) { .hero { border-right: none; } }

        h1 { font-size: 28px; margin: 0 0 12px; }
        p.muted { color: var(--muted); margin: 0 0 24px; }

        .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; }
        .stack { display: grid; gap: 12px; }
        .stack-lg { display: grid; gap: 16px; }

        input[type="text"], input[type="email"], input[type="password"] {
          width: 100%; padding: 14px 14px; border-radius: 12px;
          background: rgba(0,0,0,0.04); color: var(--text);
          border: 1px solid rgba(0,0,0,0.08);
          outline: none; transition: box-shadow .2s ease, border-color .2s ease;
        }
        input:focus { box-shadow: 0 0 0 4px var(--ring); border-color: var(--brand); }

        .dark input[type="text"], .dark input[type="email"], .dark input[type="password"] {
          background: rgba(255,255,255,0.06);
          border: 1px solid rgba(255,255,255,0.1);
        }

        .btn {
          padding: 12px 16px; border-radius: 12px;
          border: 1px solid rgba(255,255,255,0.12);
          background: linear-gradient(180deg, rgba(124,58,237,0.95), rgba(124,58,237,0.75));
          color: #fff; font-weight: 700; letter-spacing: .2px;
          cursor: pointer; box-shadow: var(--shadow);
        }
        .btn.secondary { background: rgba(0,0,0,0.06); color: var(--text); }
        .btn.ghost { background: transparent; border-color: rgba(0,0,0,0.08); }
        .btn:disabled { opacity: .6; cursor: not-allowed; }

        .dark .btn.secondary { background: rgba(255,255,255,0.06); }
        .dark .btn.ghost { border-color: rgba(255,255,255,0.08); }

        .pill {
          display: inline-flex; align-items: center; gap: 8px;
          padding: 8px 10px; border-radius: 999px;
          background: rgba(34,197,94,0.12); color: #86efac; font-weight: 600; font-size: 12px;
          border: 1px solid rgba(34,197,94,0.2);
        }

        .list { padding: 16px; }
        .item {
          padding: 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08);
          background: rgba(0,0,0,0.03);
          display: grid; gap: 8px;
        }
        .dark .item { border-color: rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); }
        .item + .item { margin-top: 10px; }
        .item-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .muted-link { color: var(--muted); text-decoration: none; }

        .tabs { display: inline-flex; background: rgba(0,0,0,0.06); padding: 4px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.08); }
        .tab { padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 600; color: var(--muted); }
        .tab.active { background: rgba(0,0,0,0.08); color: var(--text); }
        .dark .tabs { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.08); }
        .dark .tab.active { background: rgba(255,255,255,0.12); }

        .toast {
          position: fixed; right: 20px; bottom: 20px; min-width: 220px;
          background: rgba(17,24,39,0.9); border: 1px solid rgba(255,255,255,0.08);
          color: #fff; padding: 12px 14px; border-radius: 12px; box-shadow: var(--shadow);
          transform: translateY(20px); opacity: 0; transition: .25s ease;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { border-color: rgba(34,197,94,0.4); }
        .toast.error { border-color: rgba(239,68,68,0.4); }

        footer { padding: 18px; text-align: center; color: var(--muted); font-size: 12px; }
    </style>
    <script>
      const API = '/api';

      function $(q) { return document.querySelector(q); }
      function el(tag, cls) { const e = document.createElement(tag); if (cls) e.className = cls; return e; }

      function toast(message, type='success', timeout=2400) {
        const t = el('div', `toast ${type}`); t.textContent = message; document.body.appendChild(t);
        requestAnimationFrame(() => t.classList.add('show'));
        setTimeout(() => { t.classList.remove('show'); setTimeout(() => t.remove(), 250); }, timeout);
      }

      function normalizeUrl(value) {
        if (!/^https?:\/\//i.test(value)) { return 'https://' + value; }
        return value;
      }

      async function api(path, opts={}) {
        const token = localStorage.getItem('token');
        const headers = Object.assign({ 'Content-Type': 'application/json' }, opts.headers || {});
        if (token) headers['Authorization'] = `Bearer ${token}`;
        const res = await fetch(`${API}${path}`, Object.assign({}, opts, { headers }));
        if (!res.ok) throw res; return res;
      }

      function signOut() { localStorage.removeItem('token'); showAuth(); toast('Signed out', 'success'); }

      function showAuth() {
        $('#auth-pane').style.display = 'block';
        $('#app-pane').style.display = 'none';
      }
      function showApp() {
        $('#auth-pane').style.display = 'none';
        $('#app-pane').style.display = 'block';
        resetList();
        loadPage();
      }

      function applyTheme(theme) {
        const isDark = theme === 'dark';
        document.documentElement.classList.toggle('dark', isDark);
        const btn = document.querySelector('.theme-toggle');
        if (btn) btn.textContent = isDark ? '☀' : '☾';
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      }

      function toggleTheme() {
        const next = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
        applyTheme(next);
      }

      let page = 0, size = 10, loading = false, reachedEnd = false;
      function resetList() { page = 0; reachedEnd = false; $('#list').innerHTML = ''; $('#load-more').disabled = false; }
      async function loadPage() {
        if (loading || reachedEnd) return; loading = true; $('#load-more').disabled = true;
        try {
          const res = await api(`/url/user?page=${page}&size=${size}`);
          const data = await res.json();
          renderList(data);
          if (data.length < size) { reachedEnd = true; $('#load-more').disabled = true; } else { page += 1; $('#load-more').disabled = false; }
          if (page === 0 && data.length === 0) toast('No URLs yet. Create your first!', 'success');
        } catch (e) { toast('Failed to load URLs', 'error'); }
        finally { loading = false; }
      }

      function renderList(items) {
        const ul = $('#list');
        items.forEach((u) => {
          const full = `${window.location.origin}/r/${u.shortUrl}`;
          const li = el('div', 'item');
          const a = el('a', 'muted-link'); a.href = full; a.target = '_blank'; a.textContent = full;
          li.innerHTML = `<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
            <span class="pill">short</span>
            <span style="word-break:break-all">${u.originalUrl}</span>
          </div>`;
          const act = el('div', 'item-actions');
          const open = el('a', 'btn secondary'); open.href = full; open.target = '_blank'; open.textContent = 'Open';
          const copy = el('button', 'btn ghost'); copy.type = 'button'; copy.textContent = 'Copy link';
          copy.onclick = async () => { await navigator.clipboard.writeText(full); toast('Copied!'); };
          const copyCode = el('button', 'btn ghost'); copyCode.type = 'button'; copyCode.textContent = 'Copy code';
          copyCode.onclick = async () => { await navigator.clipboard.writeText(u.shortUrl); toast('Code copied!'); };
          const linkWrap = el('div'); linkWrap.appendChild(a);
          act.appendChild(open); act.appendChild(copy); act.appendChild(copyCode); act.appendChild(linkWrap);
          li.appendChild(act);
          ul.appendChild(li);
        });
      }

      async function login(email, password) {
        const res = await fetch(`${API}/auth/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });
        if (!res.ok) throw res; const data = await res.json(); localStorage.setItem('token', data.token);
      }
      async function register(email, password) {
        const res = await fetch(`${API}/auth/register`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });
        if (!res.ok) throw res; const data = await res.json(); localStorage.setItem('token', data.token);
      }
      async function createShort(originalUrl) {
        const res = await api('/url', { method: 'POST', body: JSON.stringify({ originalUrl }) });
        const data = await res.json(); return data;
      }

      window.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        applyTheme(savedTheme);

        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
          tab.addEventListener('click', () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            const mode = tab.dataset.mode;
            if (mode === 'login') { $('#login-panel').style.display = 'grid'; $('#register-panel').style.display = 'none'; }
            else { $('#login-panel').style.display = 'none'; $('#register-panel').style.display = 'grid'; }
          });
        });

        // Login
        $('#login').addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = $('#login-email').value.trim(); const password = $('#login-password').value;
          try { await login(email, password); toast('Welcome back!', 'success'); showApp(); }
          catch { toast('Invalid credentials', 'error'); }
        });

        // Register
        $('#register').addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = $('#reg-email').value.trim(); const password = $('#reg-password').value;
          try { await register(email, password); toast('Account created', 'success'); showApp(); }
          catch { toast('Registration failed', 'error'); }
        });

        // Shorten form
        $('#shorten').addEventListener('submit', async (e) => {
          e.preventDefault();
          const raw = $('#long-url').value.trim(); if (!raw) return;
          const normalized = normalizeUrl(raw);
          $('#shorten-btn').disabled = true;
          try {
            const data = await createShort(normalized);
            const full = `${window.location.origin}/r/${data.shortUrl}`;
            $('#result').innerHTML = `<div class="stack-lg"><div><span class="pill">generated</span></div><div class="row"><input type="text" value="${full}" readonly /><button type="button" class="btn secondary" id="copy-btn">Copy</button></div><div class="item-actions"><a class="btn" target="_blank" href="${full}">Open link</a><button type="button" class="btn ghost" id="copy-code">Copy code</button></div></div>`;
            $('#copy-btn').onclick = async () => { await navigator.clipboard.writeText(full); toast('Copied link'); };
            $('#copy-code').onclick = async () => { await navigator.clipboard.writeText(data.shortUrl); toast('Code copied'); };
            toast('Short URL created', 'success');
            resetList(); page = 0; loadPage();
          } catch { toast('Failed to shorten URL', 'error'); }
          finally { $('#shorten-btn').disabled = false; }
        });

        if (localStorage.getItem('token')) { showApp(); } else { showAuth(); }
      });
    </script>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 12h10" stroke="#fff" stroke-width="2" stroke-linecap="round"/><path d="M14.5 7l4.5 5-4.5 5" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
     URL Shortener by Gowtham Reddy
    </div>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">☾</button>
  </header>

  <main>
    <div class="card">
      <div class="card-inner">
        <section class="hero">
          <h1>Shorten links in seconds</h1>
          <p class="muted">Paste any long URL to get a clean, shareable short link. Manage your links with ease.</p>
          <div id="auth-pane">
            <div class="tabs" style="margin: 14px 0 18px;">
              <div class="tab active" data-mode="login">Login</div>
              <div class="tab" data-mode="register">Register</div>
            </div>
            <div id="login-panel" class="stack" style="display: grid;">
              <form id="login" class="stack">
                <input id="login-email" type="email" placeholder="Email" required />
                <input id="login-password" type="password" placeholder="Password" required />
                <button id="login-btn" class="btn" type="submit">Sign in</button>
              </form>
            </div>
            <div id="register-panel" class="stack" style="display: none;">
              <form id="register" class="stack">
                <input id="reg-email" type="email" placeholder="Email" required />
                <input id="reg-password" type="password" placeholder="Password" required />
                <button id="register-btn" class="btn" type="submit">Create account</button>
              </form>
            </div>
          </div>

          <div id="app-pane" style="display:none">
            <form id="shorten" class="row">
              <input id="long-url" type="text" placeholder="Paste a long URL (https://...)" required />
              <button id="shorten-btn" class="btn" type="submit">Shorten</button>
            </form>
            <div id="result" style="margin-top: 14px;"></div>
            <div class="item-actions" style="margin-top: 14px;">
              <button class="btn secondary" type="button" onclick="resetList(); loadPage();">Refresh</button>
              <button class="btn ghost" type="button" onclick="signOut()">Logout</button>
            </div>
          </div>
        </section>

        <section class="list">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <div style="font-weight:700;">Your Links</div>
            <div style="color:var(--muted);font-size:12px">Page size: 10</div>
          </div>
          <div id="list"></div>
          <div style="display:flex;justify-content:center;margin-top:12px;">
            <button id="load-more" class="btn secondary" type="button" onclick="loadPage()">Load more</button>
          </div>
        </section>
      </div>
    </div>
  </main>

  <footer>
    Built by Gowtham Reddy · Redirects powered by <strong>/r/&lt;code&gt;</strong>
  </footer>
</body>
</html>
